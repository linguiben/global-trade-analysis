<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Trade Analysis</title>
  <link rel="icon" href="{{ base_path }}/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { -ms-overflow-style: none; scrollbar-width: none; }
    html::-webkit-scrollbar { width: 0; height: 0; background: transparent; }
    body { background-color: #0f172a; color: #f8fafc; overflow: auto; -ms-overflow-style: none; }
    body::-webkit-scrollbar { width: 0; height: 0; background: transparent; }
    .card { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(51, 65, 85, 1); backdrop-filter: blur(8px); }
  </style>
</head>
<body class="p-4 md:p-8">
  {% set base = base_path or '' %}
  <div class="max-w-7xl mx-auto">
    <header class="mb-8 flex flex-wrap justify-between items-center gap-3">
      <div>
        <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
          Global Trade Analysis
        </h1>
        <p class="text-slate-400 text-sm mt-1" style="font-family: cursive;">$POC · data-driven trade insights$</p>
      </div>
      <div class="text-right text-xs text-slate-500 font-mono">
        Visited: {{ visited_count }}<br>{{ now }}
      </div>
      <nav class="w-full text-right text-xs text-slate-400 space-x-3">
        <a class="hover:text-blue-300" href="{{ base }}/health">Health</a>
      </nav>
    </header>

    <section class="card rounded-3xl p-6 md:p-10 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
        <div class="md:col-span-2">
          <h2 class="text-xl md:text-2xl font-bold text-slate-100">One dashboard for global trade signals</h2>
          <p class="text-slate-400 mt-2 leading-relaxed">
            This is the homepage scaffold for <span class="text-slate-200 font-semibold">Global Trade Analysis</span>.
            The goal is to progressively add widgets (trade flows, tariffs, corridors, shipping, and risk) with transparent definitions and reproducible sources.
          </p>
        </div>
        <div class="flex md:justify-end gap-3">
          <a class="px-4 py-2 rounded-xl bg-blue-600 hover:bg-blue-500 text-sm font-semibold" href="#widgets">Explore widgets</a>
          <a class="px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm font-semibold" href="#about">About</a>
        </div>
      </div>
    </section>

    <section id="widgets" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="card rounded-3xl p-6 transition-all hover:border-blue-500/50">
        <div class="text-xs text-slate-400">Widget</div>
        <div class="mt-1 text-xl font-bold">Global Trade Flow</div>
        <p class="mt-2 text-sm text-slate-400 leading-relaxed">Most active corridors (value & volume). Target cadence: monthly/quarterly (open sources).</p>
        <div class="mt-4 text-xs text-slate-500 font-mono">Status: MVP</div>
        <div class="mt-4 text-sm">
          <div class="text-slate-300 font-semibold">Top corridor (Value)</div>
          <div id="trade_value_top" class="text-slate-400 text-sm mt-1 font-mono">Loading…</div>
          <div class="text-slate-300 font-semibold mt-3">Top corridor (Volume)</div>
          <div id="trade_volume_top" class="text-slate-400 text-sm mt-1 font-mono">Loading…</div>
          <div id="trade_period" class="text-xs text-slate-500 mt-3 font-mono"></div>
          <div id="trade_source" class="text-xs text-slate-500 mt-1 font-mono"></div>
        </div>
      </div>

      <div class="card rounded-3xl p-6 transition-all hover:border-emerald-500/50">
        <div class="text-xs text-slate-400">Widget</div>
        <div class="mt-1 text-xl font-bold">Global Wealth Distribution</div>
        <p class="mt-2 text-sm text-slate-400 leading-relaxed">Proxy-based wealth/spending by age group + shift pace (India/Mexico/Singapore/HK).</p>
        <div class="mt-4 text-xs text-slate-500 font-mono">Status: MVP (proxy)</div>
        <div class="mt-4 text-sm">
          <div class="text-slate-300 font-semibold">Fastest shift pace (proxy)</div>
          <div id="wealth_fastest" class="text-slate-400 text-sm mt-1 font-mono">Loading…</div>
          <div id="wealth_source" class="text-xs text-slate-500 mt-3 font-mono"></div>
        </div>
      </div>

      <div class="card rounded-3xl p-6 transition-all hover:border-fuchsia-500/50">
        <div class="text-xs text-slate-400">Widget</div>
        <div class="mt-1 text-xl font-bold">Global Financial Flow</div>
        <p class="mt-2 text-sm text-slate-400 leading-relaxed">Big transactions feed (near-real-time via open news feeds; always source-linked).</p>
        <div class="mt-4 text-xs text-slate-500 font-mono">Status: MVP</div>
        <div class="mt-4 text-sm">
          <div class="text-slate-300 font-semibold">Latest big tickets</div>
          <ul id="finance_list" class="mt-2 space-y-2 text-slate-400 text-sm"></ul>
          <div id="finance_source" class="text-xs text-slate-500 mt-3 font-mono"></div>
        </div>
      </div>
    </section>

    <script>
      const BASE = "{{ base }}";

      function fmtUSD(n) {
        if (n == null) return "—";
        const abs = Math.abs(n);
        if (abs >= 1e12) return (n/1e12).toFixed(2) + "T";
        if (abs >= 1e9) return (n/1e9).toFixed(2) + "B";
        if (abs >= 1e6) return (n/1e6).toFixed(2) + "M";
        return String(n);
      }

      function fmtKG(n) {
        if (n == null) return "—";
        const abs = Math.abs(n);
        if (abs >= 1e12) return (n/1e12).toFixed(2) + "T kg";
        if (abs >= 1e9) return (n/1e9).toFixed(2) + "B kg";
        if (abs >= 1e6) return (n/1e6).toFixed(2) + "M kg";
        return n + " kg";
      }

      async function loadTrade() {
        const res = await fetch(`${BASE}/api/trade/corridors`);
        const data = await res.json();
        const v = (data.value_usd_top || [])[0];
        const vol = (data.volume_top || [])[0];
        document.getElementById('trade_value_top').textContent = v ? `${v.origin} → ${v.dest} · $${fmtUSD(v.value_usd)}` : '—';
        document.getElementById('trade_volume_top').textContent = vol ? `${vol.origin} → ${vol.dest} · ${fmtKG(vol.volume_kg)}` : '—';
        document.getElementById('trade_period').textContent = `Period: ${data.period || '—'}`;
        document.getElementById('trade_source').textContent = `Source: ${data.source} · Updated: ${data.updated_at}`;
      }

      async function loadWealth() {
        const res = await fetch(`${BASE}/api/wealth/proxy`);
        const data = await res.json();
        const pace = data.shift_pace_proxy || {};
        let best = null;
        for (const [k, v] of Object.entries(pace)) {
          if (best == null || v > best.v) best = {k, v};
        }
        document.getElementById('wealth_fastest').textContent = best ? `${best.k} · +${best.v}% (proxy)` : '—';
        document.getElementById('wealth_source').textContent = `Source: ${data.source} · Updated: ${data.updated_at}`;
      }

      async function loadFinance() {
        const res = await fetch(`${BASE}/api/finance/big-transactions`);
        const data = await res.json();
        const ul = document.getElementById('finance_list');
        ul.innerHTML = '';
        for (const t of (data.transactions || []).slice(0, 5)) {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = t.link;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.className = 'hover:text-fuchsia-300';
          a.textContent = `${t.date} · ${t.type} · $${fmtUSD(t.value_usd)} · ${t.headline}`;
          li.appendChild(a);
          ul.appendChild(li);
        }
        document.getElementById('finance_source').textContent = `Source: ${data.source} · Updated: ${data.updated_at}`;
      }

      Promise.allSettled([loadTrade(), loadWealth(), loadFinance()]).catch(() => {});
    </script>

    <section id="about" class="mt-6 card rounded-3xl p-6">
      <h3 class="text-lg font-bold">Notes</h3>
      <ul class="mt-3 text-sm text-slate-400 space-y-2 list-disc pl-5">
        <li>All definitions should be explicit and source-linked (WTO/UN Comtrade/IMF/World Bank where applicable).</li>
        <li>Methodology will distinguish <span class="text-slate-200">value</span>, <span class="text-slate-200">volume</span>, and <span class="text-slate-200">shipping capacity</span> to avoid ambiguity.</li>
      </ul>
    </section>

    <footer class="mt-8 text-xs text-slate-600">
      Global Trade Analysis · GTA · {{ now }}
    </footer>
  </div>
</body>
</html>
